<div class="custom-container">
    <h2 class="custom-header">Feedback</h2>

    <!-- Form for submitting data -->
    <form id="customForm" onsubmit="return submitForm()">
        <!-- Text Input -->
        <div class="custom-field-group">
            <label for="customTextInput" class="custom-label">Enter Text:</label>
            <input type="text" id="customTextInput" name="customTextInput" class="custom-input" placeholder="Type here..." required />
        </div>

        <input class="custom-submit" type="submit" value="Submit" />
    </form>
</div>

<!-- Custom Styles -->
<style>
    .custom-container {
        padding: 20px;
        background-color: #f7f8fa;
        border: 1px solid #dfe1e6;
        border-radius: 5px;
        max-width: 400px;
        margin: 0 auto;
    }

    .custom-header {
        font-size: 20px;
        color: #172b4d;
        font-weight: 600;
        text-align: center;
        margin-bottom: 20px;
    }

    .custom-field-group {
        margin-bottom: 15px;
        padding; 15px;
        display: flex;
        flex-direction: column;
    }

    .custom-label {
        font-size: 14px;
        color: #5e6c84;
        margin-bottom: 5px;
    }

    .custom-input {
        width: 94%;
        padding: 10px;
        font-size: 14px;
        border-radius: 3px;
    }

    .custom-submit {
        width: 100%;
        padding: 10px;
        font-size: 14px;
        color: white;
        background-color: #0052cc;
        border: none;
        border-radius: 3px;
        cursor: pointer;
    }

    .custom-submit:hover {
        background-color: #0065ff;
    }
</style>

<!-- JavaScript to Handle Form Submission -->
<script>
async function submitForm() {
    // Get the value from the text input
    const customText = document.getElementById('customTextInput').value;

    // Validate the form input
    if (!customText) {
        alert('Please enter text.');
        return false;
    }

    const apiUrl = `https://feed-uvl.ifi.uni-heidelberg.de/hitec/jira/uvldashboard/return_dashboard/${customText}`;

    // Alert the generated URL
    alert('Generated URL: ' + apiUrl);

    try {
        // Fetch data from the API
        const response = await fetch(apiUrl);
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        
        const data = await response.text(); // Or use .json() based on the expected response format
        // Call your backend to store the data
        await storeDataInJira(data);
    } catch (error) {
        console.error('Error fetching data:', error);
        alert('Error fetching data from API: ' + error.message);
    }

    return false; // Prevent default form submission
}

// Function to store data in Jira
async function storeDataInJira(data) {
    const response = await fetch('/rest/myplugin/1.0/store', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ responseData: data }),
    });

    if (response.ok) {
        alert('Data stored successfully in Jira.');
    } else {
        alert('Failed to store data in Jira: ' + response.statusText);
    }
}
</script>
